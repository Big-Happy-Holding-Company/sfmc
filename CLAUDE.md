# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

**Development Server:**
- `npm run dev` - Start development server on port 5000 (always running in development)
- Visit at `localhost:5000`

**Build & Deployment:**
- `npm run build` - Production build (Vite frontend + esbuild backend)
- `npm run start` - Start production server
- `npm run check` - TypeScript type checking

**Database:**
- `npm run db:push` - Push Drizzle schema changes to database

**Task Generation CLI:**
```powershell
# Generate single task
npx tsx server\cli\generate-task.ts single -c <CATEGORY> -t <TRANSFORMATION> -o <OUTPUT_PATH>

# Generate all tasks for category
npx tsx server\cli\generate-task.ts category -c <CATEGORY> -o <OUTPUT_DIR>

# Generate all tasks
npx tsx server\cli\generate-task.ts all -o <OUTPUT_DIR>

# List available categories/transformations
npx tsx server\cli\generate-task.ts list
```

## Architecture

**Full-Stack TypeScript Application:**
- **Frontend**: React + Vite (client/)
- **Backend**: Express.js (server/)
- **Database**: Drizzle ORM with PostgreSQL (production), in-memory (development)
- **Styling**: Tailwind CSS + shadcn/ui components

**Directory Structure:**
```
client/src/
â”œâ”€â”€ components/game/     # Core game components
â”œâ”€â”€ components/ui/       # shadcn UI components
â”œâ”€â”€ constants/           # Emoji sets and game constants
â”œâ”€â”€ types/              # TypeScript type definitions
â””â”€â”€ pages/              # Route components

server/
â”œâ”€â”€ data/tasks/         # Individual JSON task files (CORE SYSTEM)
â”œâ”€â”€ templates/          # Task generation templates
â”œâ”€â”€ tools/              # Task/story generation utilities
â”œâ”€â”€ services/           # Business logic services
â”œâ”€â”€ cli/                # CLI tools for task generation
â”œâ”€â”€ index.ts            # Server entry point
â”œâ”€â”€ routes.ts           # API route handlers
â””â”€â”€ storage.ts          # Data storage interface

shared/
â””â”€â”€ schema.ts           # Database schema and types
```

**Path Aliases:**
- `@/` â†’ `client/src/`
- `@shared/` â†’ `shared/`

## Task System

**Task File Structure:**
- Tasks stored as individual JSON files in `server/data/tasks/`
- **CRITICAL**: Use integers 0-9 in task data files, NOT emojis
- Emojis are mapped only in UI layer via `client/src/constants/spaceEmojis.ts`
- Task ID format: `CATEGORY-XXX` (e.g., COM-001, NAV-100, PWR-230)

**Task Categories:**
- `COM-XXX`: ğŸ“¡ Communications
- `FS-XXX`: ğŸ“Š Fuel Systems  
- `NAV-XXX`: ğŸ§­ Navigation
- `OS-XXX`: ğŸ›¡ï¸ Oâ‚‚ Sensor Check
- `PL-XXX`: ğŸš€ Pre-Launch Ops
- `PWR-XXX`: âš¡ Power Systems
- `SEC-XXX`: ğŸ”’ Security

**Emoji Set System:**
- Source of truth: `client/src/constants/spaceEmojis.ts`
- Each set has exactly 10 emojis mapping to integers 0-9
- Index 0 is always `â¬›` (black, NOT the same as background, any color can be background)
- Available sets: `tech_set1`, `tech_set2`, `celestial_set1`, `celestial_set2`, `nav_alerts`, `status_alerts`, `weather_climate`, etc.

**Task Template:**
```json
{
  "id": "CATEGORY-XXX",
  "title": "Creative title incorporating transformation logic",
  "description": "Space Force themed task description",
  "category": "Category with emoji prefix",
  "difficulty": "Basic",
  "gridSize": 3,
  "timeLimit": null,
  "basePoints": 1500,
  "requiredRankLevel": 1,
  "emojiSet": "tech_set1",
  "examples": [{"input": [[0,1],[1,0]], "output": [[1,0],[0,1]]}],
  "testInput": [[0,1],[1,0]],
  "testOutput": [[1,0],[0,1]],
  "hints": ["Progressive hint 1", "Progressive hint 2", "Final solution with developer credit"]
}
```

## ARC-AGI Integration

**Space Force Mission Control 2045** is built on the Abstract Reasoning Corpus (ARC-AGI) framework:
- Transforms ARC-AGI puzzles into Space Force themed operational tasks
- Maintains ARC-AGI's 0-9 integer system with space emoji overlay
- Supports standard ARC-AGI file imports

**Transformation Types:**
- Geometric: rotation (90Â°, 180Â°, 270Â°), reflection (horizontal, vertical, diagonal)
- Pattern: completion, extension, repetition, sequence prediction
- Logical: AND/OR/XOR/NOT operations, conditional logic
- Spatial: inside/outside, adjacent, containment, proximity relationships
- Object: counting, sorting, grouping, filtering

## Development Guidelines

**Adding New Tasks:**
1. Use CLI tools for systematic generation
2. Follow integer-only format in JSON files
3. Add progressive hints with final developer credit
4. Test transformation logic thoroughly
5. Use appropriate emoji set for theme

**Story Wrapper System:**
- `server/data/problems.json` - Narrative templates by transformation type
- `server/data/antagonists.json` - Mischievous characters
- `server/data/components.json` - Ship components
- Stories auto-generated by `server/tools/story-factory.ts`

**Game Mechanics:**
- Rank progression through Space Force enlisted ranks
- Points system with speed bonuses and hint penalties  
- Task validation via `POST /api/players/:id/validate-solution`

**API Endpoints:**
- `GET/POST /api/players` - Player management
- `GET /api/tasks` - Task retrieval
- `POST /api/players/:id/validate-solution` - Solution submission